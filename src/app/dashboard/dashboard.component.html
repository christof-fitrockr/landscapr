<div class="container-xl mt-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="btn-group">
      <button type="button" class="btn btn-outline-secondary shadow-sm ml-2" title="Refresh" (click)="refresh()">
        <i class="fas fa-sync"></i>
      </button>
    </div>
    <h2 class="m-0 font-weight-bold text-uppercase text-gray-400">Dashboard</h2>
  </div>

  <!-- Journeys Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0 fw-bold text-slate-900">
        <i class="fas fa-map-signs mr-2"></i> Journeys
      </h5>
    </div>
    <div class="card-body">
      <div class="fa-3x text-center p-5" *ngIf="!journeys">
        <i class="fas fa-spinner fa-pulse"></i>
      </div>

      <div *ngIf="journeys && journeys.length === 0" class="small font-italic text-muted">No journeys available. Create one from the Journeys page.</div>

      <div class="row" *ngIf="journeys && journeys.length > 0">
        <div class="col-md-6 col-lg-4 mb-3" *ngFor="let j of journeys">
          <div class="card h-100 shadow-sm cursor-pointer dashboard-card" [routerLink]="['/journeys/editor', j.id]">
            <div class="card-body p-3">
              <h4 class="card-title fw-bold mb-1 text-truncate" [title]="j.name">
                <i class="fas fa-map-signs mr-1 text-primary"></i> {{ j.name }}
              </h4>
              <p class="card-text small text-muted text-truncate-2 mb-0">
                {{ j.description || 'No description' }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Processes Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0 fw-bold text-slate-900">
        <i class="fas fa-project-diagram mr-2"></i> Favorite Processes
      </h5>
    </div>
    <div class="card-body">
      <div class="fa-3x text-center p-5" *ngIf="!processes">
        <i class="fas fa-spinner fa-pulse"></i>
      </div>

      <div *ngIf="processes && processes?.length === 0" class="small font-italic text-muted">No favorite processes available.</div>

      <div class="row" *ngIf="processes && processes?.length > 0">
        <div class="col-md-6 col-lg-4 mb-3" *ngFor="let p of processes">
          <div class="card h-100 shadow-sm cursor-pointer dashboard-card" [routerLink]="['/process/view', p.id]">
            <div class="card-body p-3">
              <h4 class="card-title fw-bold mb-1 text-truncate" [title]="p.name">
                <i class="fas fa-project-diagram mr-1 text-primary"></i> {{ p.name }}
              </h4>
              <p class="card-text small text-muted text-truncate-2 mb-0">
                {{ p.description || 'No description' }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Repository Changes Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0 fw-bold text-slate-900">
        <i class="fab fa-github mr-2"></i> Recent Repository Changes
      </h5>
    </div>
    <div class="card-body">
      <div *ngIf="!repoName" class="alert alert-info" role="alert">
        <i class="fas fa-info-circle mr-2"></i>
        No repository selected. Please select a repository in the <a routerLink="/repositories" class="alert-link">Repositories</a> page.
      </div>

      <div class="fa-3x text-center p-5" *ngIf="loadingCommits">
        <i class="fas fa-spinner fa-pulse"></i>
      </div>

      <div *ngIf="repoName && !loadingCommits && commits.length === 0" class="small font-italic text-muted">No recent commits found on branch main.</div>

      <div class="table-responsive" *ngIf="repoName && !loadingCommits && commits.length > 0">
        <table class="table table-sm table-striped mb-0">
          <thead>
            <tr>
              <th scope="col" class="w-50">Message</th>
              <th scope="col" class="w-25">Author</th>
              <th scope="col" class="w-25">Date</th>
              <th scope="col" class="text-right">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let commit of commits">
              <td class="small">{{ commit.commit.message }}</td>
              <td class="small">{{ commit.commit.author.name }}</td>
              <td class="small text-muted">{{ commit.commit.author.date | date:'medium' }}</td>
              <td class="text-right">
                <a class="btn btn-sm btn-outline-secondary" [href]="commit.html_url" target="_blank" title="Open on GitHub">
                  <i class="fab fa-github"></i>
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
