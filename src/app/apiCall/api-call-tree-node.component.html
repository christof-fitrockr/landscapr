<ng-container *ngIf="shouldShowGroup()">
  <!-- Group Row -->
  <tr class="api-group-node hover-bg-light border-bottom pointer" (click)="toggleExpand()">
    <td colspan="8" class="py-2">
      <div class="d-flex align-items-center">
        <div style="width: 25px" class="text-center">
          <i class="fas fa-sm" [class.fa-chevron-down]="isExpanded" [class.fa-chevron-right]="!isExpanded"></i>
        </div>
        <div class="flex-grow-1 font-weight-bold">
          {{ group.name }} <span class="badge badge-light ml-2">{{ group.items.length }}</span>
        </div>
      </div>
    </td>
  </tr>

  <!-- Items -->
  <ng-container *ngIf="isExpanded">
    <ng-container *ngFor="let apiCall of group.items">
      <tr class="hover-bg-light border-bottom" *ngIf="shouldShowItem(apiCall)"
          [class.pointer]="selectMode" (click)="selectMode ? onSelect(apiCall) : null">

        <!-- 1. Spacer -->
        <td style="width: 25px"></td>

        <!-- 2. Actions or Spacer -->
        <td style="width: 52px" class="text-nowrap pl-0">
          <div *ngIf="!selectMode" class="d-flex align-items-center">
            <a class="black mr-2" routerLink="/apiCall/edit/{{apiCall?.id}}"><i class="fas fa-edit"></i></a>
            <a class="black" style="cursor: pointer" (click)="prepareDelete(apiCall)" data-toggle="modal" data-target="#confirmDeleteApiCall"><i class="fas fa-trash" title="Delete API Call"></i></a>
          </div>
        </td>

        <!-- 3. Name -->
        <td>
          <span *ngIf="selectMode" class="font-weight-bold">{{apiCall.name}}</span>
          <a *ngIf="!selectMode" class="black font-weight-bold" routerLink="/apiCall/edit/{{apiCall?.id}}">{{apiCall.name}}</a>
          <i *ngIf="orphanIds.includes(apiCall.id)" class="ml-2 text-warning fas fa-unlink" title="Orphan: Not referenced by any Process"></i>
        </td>

        <!-- 4. Type -->
        <td style="width: 120px" class="small text-muted align-middle">
          {{ apiCall.apiType | apiType }}
        </td>

        <!-- 5. Used -->
        <td class="text-right text-muted small align-middle" style="width: 80px">
          <ng-container *ngIf="!selectMode">{{apiCall.usedByCount || 0}}</ng-container>
        </td>

        <!-- 6. Impl -->
        <td class="text-right text-muted small align-middle" style="width: 80px">
          <ng-container *ngIf="!selectMode">{{apiCall.implementedInCount || 0}}</ng-container>
        </td>

        <!-- 7. Tags -->
        <td style="width: 25%" class="small text-muted align-middle">
          {{apiCall.tags}}
        </td>

        <!-- 8. Status -->
        <td style="width: 30px" class="text-right align-middle">
          <div *ngIf="!selectMode">
            <i *ngIf="apiCall?.status === 0" class="text-warning fas fa-exclamation-triangle" title="Draft"></i>
            <i *ngIf="apiCall?.status === 1" class="text-success fas fa-check-circle" title="Validated"></i>
          </div>
          <div *ngIf="selectMode">
            <i class="fas fa-plus text-primary"></i>
          </div>
        </td>
      </tr>

      <!-- Description Row (if present) -->
      <tr *ngIf="shouldShowItem(apiCall) && apiCall.description">
        <td colspan="8" class="small text-muted pl-5 py-1 border-bottom bg-light">
          {{apiCall.description}}
        </td>
      </tr>
    </ng-container>
  </ng-container>
</ng-container>
