<tr class="tree-row" [style.--depth]="level" [class.table-info]="process.comments?.length > 0" [class.pointer]="selectMode" (click)="selectMode ? onSelect(process) : null">
  <td class="text-nowrap tree-indent-cell" [style.border-left]="'4px solid ' + getRoleColor(process.role)">
    <div *ngIf="childProcesses.length > 0" class="toggle-icon pointer" (click)="toggle(); $event.stopPropagation()">
      <i class="fas fa-sm" [class.fa-chevron-down]="expanded" [class.fa-chevron-right]="!expanded"></i>
    </div>
    <div *ngIf="childProcesses.length === 0" class="toggle-icon"></div> <!-- Spacer -->

    <ng-container *ngIf="!selectMode">
      <a class="btn btn-icon btn-sm text-muted" routerLink="/process/view/{{process?.id}}" title="View Process"><i class="fas fa-eye"></i></a>
      <a class="btn btn-icon btn-sm text-muted" routerLink="/process/edit/{{process?.id}}" title="Edit Process"><i class="fas fa-edit"></i></a>
      <button class="btn btn-icon btn-sm text-muted" (click)="onShowDescription(process); $event.stopPropagation()" title="Show Description"><i class="fas fa-info-circle text-info"></i></button>
      <button class="btn btn-icon btn-sm text-muted" (click)="onPrepareDelete(process); $event.stopPropagation()" data-toggle="modal" data-target="#confirmDeleteProcess" title="Delete Process"><i class="fas fa-trash"></i></button>
    </ng-container>
  </td>
  <td>
    <span *ngIf="selectMode" class="font-weight-bold">{{process.name}}</span>
    <a *ngIf="!selectMode" class="font-weight-bold " routerLink="/process/edit/{{process?.id}}">{{process.name}}</a>
    <i *ngIf="orphanIds.includes(process.id)" class="ml-2 text-warning fas fa-unlink" title="Orphan: Not referenced by any Journey"></i>
  </td>
  <td>
    <div class="d-flex align-items-center">
      <i class="fas fa-comments mr-2" [class.text-muted]="!process.comments || process.comments.length === 0"></i>
      <span [class.text-muted]="!process.comments || process.comments.length === 0">{{process.comments?.length || 0}}</span>
    </div>
  </td>
  <td>{{process?.tags}}</td>
  <td class="text-nowrap pl-1 pr-1">
    <span *ngIf="process?.apiCallIds?.length > 0" class="badge badge-secondary mr-1" title="API Calls">{{process?.apiCallIds?.length}} API</span>
    <span *ngIf="process?.steps?.length > 0" class="badge badge-secondary" title="Steps">{{process?.steps?.length}} Steps</span>
  </td>
  <td class="text-nowrap pl-1 pr-1" *ngIf="!selectMode">
    <span *ngIf="process?.status === 0" class="badge-modern badge-draft">Draft</span>
    <span *ngIf="process?.status === 1" class="badge-modern badge-validated">Validated</span>
    <span *ngIf="process?.status === 2" class="badge-modern badge-review">Review</span>
  </td>
  <td class="text-nowrap pl-1 pr-1 text-right" *ngIf="selectMode" style="width: 30px">
    <i class="fas fa-plus text-primary"></i>
  </td>
</tr>

<ng-container *ngIf="expanded">
  <ng-container *ngFor="let child of childProcesses | processFilter : allProcesses : filter : showOrphansOnly : orphanIds : filterStatus : filterComments; trackBy: trackByProcessId">
    <app-process-tree-node
      [process]="child"
      [allProcesses]="allProcesses"
      [level]="level + 1"
      [repoId]="repoId"
      [orphanIds]="orphanIds"
      [filter]="filter"
      [filterStatus]="filterStatus"
      [filterComments]="filterComments"
      [showOrphansOnly]="showOrphansOnly"
      [selectMode]="selectMode"
      (deleted)="onDeleted()"
      (prepareDelete)="onPrepareDelete($event)"
      (select)="onSelect($event)"
      (showDescription)="onShowDescription($event)"
    ></app-process-tree-node>
  </ng-container>
</ng-container>
